<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.Arch. Curriculum & Technology Planner (4-Year) - Nitte University</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <!-- Optional: for icons -->

    <style>
        /* --- Start of Refined CSS v4 (Inherited and Extended) --- */
        :root {
            --primary-color: #0077b6; /* Slightly softer blue */
            --primary-dark: #023e8a;
            --secondary-color: #48cae4; /* Complementary lighter blue */
            --secondary-dark: #0096c7;
            --text-color: #333;
            --heading-color: #1a202c; /* Even darker blue-grey */
            --background-color: #f4f7f6; /* Light grey background */
            --container-bg: #fff;
            --border-color: #e9ecef; /* Lighter border grey */
            --light-grey: #f8f9fa; /* Very light grey */
            --medium-grey: #ced4da; /* Medium grey for borders/dividers */
            --dark-grey: #6c757d; /* Slightly darker grey for helper text */
            --editable-bg: #fffbe6; /* Soft yellow for editable */
            --highlight-color: #e0f7fa; /* Very light blue highlight on focus */
            --delete-color: #e74c3c; /* Red */
            --delete-dark: #c0392b;

            /* New color for unused themes */
            --unused-bg: #f8d7da; /* Very light red background */
            --unused-text: #721c24; /* Darker red text */
            --unused-border: #f5c6cb; /* Medium red border */
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 25px 20px; /* More vertical padding */
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 15px; /* Slightly smaller base size */
        }

        .curriculum-planner {
            max-width: 1800px;
            margin: 20px auto;
            background-color: var(--container-bg);
            padding: 40px 50px; /* Increased padding */
            border-radius: 12px; /* Slightly more rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Softer, wider shadow */
        }

        h1, h2 {
             text-align: center;
             color: var(--heading-color);
             font-weight: 600;
        }
        h1 { font-size: 2.4em; margin-bottom: 10px; margin-top: 0;}
        h2 { font-size: 1.4em; margin-bottom: 45px; font-weight: 400; color: var(--dark-grey); }

        h3 { /* Semester Titles */
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px; /* More padding below title */
            margin-top: 60px; /* More space above sections */
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.7em;
        }
         h4 { /* General Notes Title */
            color: var(--heading-color);
            margin-top: 50px;
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 500; /* Slightly less bold */
         }

        .semester-summary {
            font-size: 0.95em;
            font-style: italic;
            color: var(--dark-grey);
            margin-top: 10px;
            margin-bottom: 35px; /* More space below summary */
            padding: 18px 25px; /* Increased padding */
            background-color: var(--light-grey);
            border-left: 5px solid var(--primary-color); /* Wider border */
            border-radius: 5px; /* Slightly more rounded */
            min-height: 45px; /* Ensure clickable area */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
             line-height: 1.5; /* Slightly more open line height */
             white-space: pre-wrap; /* Ensure line breaks are respected */
        }
        .semester-summary[contenteditable="true"] {
            background-color: var(--editable-bg);
            cursor: text;
        }
        .semester-summary[contenteditable="true"]:focus {
             outline: none;
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2); /* Softer, blue outline */
             background-color: var(--container-bg);
             font-style: normal; /* Remove italic when editing */
        }

        p.instructions {
            display: block;
            text-align: center;
            margin-bottom: 45px; /* More space below instructions */
            color: var(--dark-grey);
            font-size: 0.9em;
            font-style: italic;
            line-height: 1.5;
        }

        /* Table Container for Responsiveness */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 25px; /* More space below table */
            border: 1px solid var(--border-color); /* Add light border to container */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }
         /* Scrollbar styling */
        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }
        .table-responsive::-webkit-scrollbar-thumb {
            background: var(--medium-grey);
            border-radius: 10px;
        }
        .table-responsive::-webkit-scrollbar-track {
            background: var(--light-grey);
        }
         .table-responsive table {
             border: none; /* Remove inner table border as container has one */
         }

        /* Planner Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1700px; /* Slightly wider min-width */
            font-size: 0.9em; /* Slightly smaller table font */
            table-layout: fixed;
        }

        th, td {
            border: 1px solid var(--border-color); /* Lighter inner borders */
            padding: 14px 12px; /* More padding */
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
             line-height: 1.5; /* Open line height in cells */
        }

        th {
            background-color: #eef2f7; /* Very light blueish-grey header */
            color: var(--heading-color);
            font-weight: 600;
            vertical-align: middle;
            position: sticky;
            top: 0;
            z-index: 1;
            border-bottom: 2px solid var(--medium-grey); /* Stronger bottom border */
        }
         th small {
             display: block;
             font-weight: 400;
             font-size: 0.8em; /* Smaller hint text */
             color: var(--dark-grey);
             margin-top: 5px;
         }

        /* Apply specific widths to columns (12 columns including Delete) */
        th:nth-child(1), td:nth-child(1) { width: 4%; }  /* Code (Increased slightly) */
        th:nth-child(2), td:nth-child(2) { width: 11%; } /* Title (Adjusted) */
        th:nth-child(3), td:nth-child(3) { width: 4%; text-align: center; } /* Credits */
        th:nth-child(4), td:nth-child(4) { width: 8%; }  /* Default RIBA (D) */
        th:nth-child(5), td:nth-child(5) { width: 8%; }  /* Acad/Prac RIBA (D) */
        th:nth-child(6), td:nth-child(6) { width: 10%; } /* Acad/Prac Notes (Adjusted) */
        th:nth-child(7), td:nth-child(7) { width: 8%; }  /* Ethics RIBA (D) */
        th:nth-child(8), td:nth-child(8) { width: 10%; } /* Ethics Notes (Adjusted) */
        th:nth-child(9), td:nth-child(9) { width: 8%; }  /* Tech RIBA (D) */
        th:nth-child(10), td:nth-child(10){ width: 10%; }/* Tech Notes (Adjusted) */
        th:nth-child(11), td:nth-child(11){ width: 5%; }  /* Remarks */
        th:nth-child(12), td:nth-child(12){ width: 1%; text-align: center;} /* Actions (Adjusted width) */


        tbody tr:nth-child(even) {
            background-color: var(--f8f9fa); /* Very subtle zebra striping */
        }

        tbody tr:hover:not(.total-credits-row) {
            background-color: var(--highlight-color); /* Light blue hover */
        }

        td[contenteditable="true"] {
            background-color: var(--container-bg);
            cursor: text;
            min-height: 35px; /* Ensure space for editing */
            outline: none;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
             white-space: pre-wrap;
        }

        td[contenteditable="true"]:hover {
             background-color: var(--editable-bg); /* Hint on hover */
        }

        td[contenteditable="true"]:focus {
            background-color: var(--highlight-color);
            box-shadow: inset 0 0 0 1px var(--primary-color); /* Inner border on focus */
        }

        /* Styling for RIBA dropdown cell */
        td.riba-cell {
             background-color: var(--container-bg);
             padding: 8px 6px; /* Adjusted padding for select */
             vertical-align: middle;
        }

        select.riba-select {
            width: 100%;
            padding: 8px 6px; /* Adjusted padding */
            border: 1px solid var(--medium-grey);
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9em;
            background-color: var(--container-bg);
            box-sizing: border-box;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center; /* More space for arrow */
            background-size: 12px auto; /* Slightly larger arrow */
            cursor: pointer;
        }
        select.riba-select:focus {
             outline: none;
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
        }
         select.riba-select option {
             padding: 4px;
         }


        /* Styling for the total credits row */
        .total-credits-row td {
            background-color: #e9ecef;
            font-weight: 600; /* Slightly less bold */
            color: var(--heading-color);
            border-top: 2px solid var(--medium-grey);
            vertical-align: middle;
            padding: 14px 12px; /* Match row padding */
        }
        .total-credits-row td:first-child { text-align: right; padding-right: 20px;} /* More space */
        .total-credits-row td:nth-child(2) { /* Total Credits Number */
            font-size: 1.1em;
            text-align: center;
            font-weight: 700; /* Make number bolder */
            color: var(--primary-dark); /* Highlight total */
        }
         /* The third TD in total row now spans the remaining 9 columns */
        .total-credits-row td:nth-child(3) {
             background-color: transparent;
        }


        /* General Notes Area */
        #general-notes-section {
             margin-top: 60px; /* More space above */
        }
        #general-notes-area {
            width: 100%;
            min-height: 200px; /* Taller textarea */
            padding: 15px;
            border: 1px solid var(--medium-grey);
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            box-sizing: border-box;
            resize: vertical;
             outline: none;
             transition: border-color 0.3s ease, box-shadow 0.3s ease;
             line-height: 1.6;
        }
         #general-notes-area:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
         }

        /* Buttons */
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 13px 28px; /* Slightly larger padding */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            border-radius: 6px; /* Slightly more rounded */
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            margin-top: 20px; /* More space above buttons */
            margin-right: 10px;
            font-weight: 500; /* Medium weight */
        }

        button:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        button:active {
             background-color: #00548c;
             box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        #save-button {
             background-color: var(--secondary-dark); /* Use a related blue */
             padding: 13px 35px; /* Make save button slightly larger */
             font-weight: 600;
        }
        #save-button:hover {
             background-color: var(--secondary-color);
        }
         #save-button:active {
             background-color: var(--primary-dark); /* Darken on click */
         }


        .add-course-button-container {
             margin-top: 15px; /* Space above add button */
             text-align: left; /* Align add button left */
        }
         .action-buttons {
             text-align: center;
             margin-top: 50px; /* More space above global action buttons */
         }


        /* Delete button specific styles */
        td.delete-cell {
             text-align: center;
             vertical-align: middle;
             padding: 10px 6px; /* Adjusted padding to be less */
        }
        .delete-row-button {
             background: none;
             border: none;
             color: var(--delete-color); /* Red color for delete */
             font-size: 1.3em; /* Slightly larger icon */
             cursor: pointer;
             padding: 4px; /* Reduced padding */
             margin: 0;
             transition: color 0.2s ease;
             line-height: 1;
             display: inline-flex;
             align-items: center;
             justify-content: center;
        }
        .delete-row-button:hover {
             color: var(--delete-dark);
             background: none;
             box-shadow: none;
        }
         .delete-row-button:active {
             color: #a93226; /* Even darker red */
             background: none;
             box-shadow: none;
         }

        /* New styles for Unused RIBA Themes section */
        .unused-riba-section {
            margin-top: 25px;
            margin-bottom: 30px;
            padding: 15px 20px;
            background-color: var(--unused-bg);
            border: 1px solid var(--unused-border);
            border-radius: 5px;
            font-size: 0.9em;
            color: var(--unused-text);
            line-height: 1.5;
        }
         .unused-riba-section p {
             margin: 0; /* Remove default paragraph margin */
             white-space: pre-wrap; /* Preserve line breaks if needed */
         }
         .unused-riba-section strong {
             color: var(--unused-text); /* Ensure title is also dark red */
         }


        /* Optional: Toast/Notification for save */
        .save-notification {
            position: fixed;
            bottom: 25px; /* Higher from bottom */
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745; /* Success green */
            color: white;
            padding: 14px 25px; /* More padding */
            border-radius: 6px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             font-size: 1em;
             font-weight: 500;
        }
        .save-notification.show {
            opacity: 1;
            visibility: visible;
        }
         .save-notification.error {
             background-color: #dc3545; /* Error red */
         }


        /* --- End of Refined CSS v4 (Inherited and Extended) --- */
    </style>
</head>
<body>

<div class="curriculum-planner">
    <h1>B.Arch. Curriculum & Technology Planner (4-Year / 8 Semesters)</h1>
    <h2>Nitte Institute of Architecture - Based on Batch 2020-21 Regulations (Adapted)</h2>
    <p class="instructions"><em>This is an adaptation of the 5-year structure to fit into 4 years (8 semesters). Courses and credits have been consolidated. Click on table cells or summary paragraphs to edit. Use dropdowns for Default and Direct RIBA theme connections. Credit totals update automatically. Unused RIBA themes per semester are listed below each table. Use the 'Save Planner' button to store your edits locally in your browser. Delete rows using the <span style="color: var(--delete-color); font-weight: 600;">&times;</span> button in the Actions column.</em></p>

    <!-- --- Semester Tables (Sem 1 to 8) --- -->

    <!-- Semester 1 -->
    <div class="semester-section">
        <h3>Semester 1 (Level 1: Foundation)</h3>
        <p class="semester-summary" id="sem1-summary" contenteditable="true">
            **Overall Theme:** Fundamentals of Design and Representation<br>
            **Focus:** This semester lays the essential groundwork for the entire program. The focus is on developing fundamental visual literacy, manual and basic digital representation skills, introducing foundational design concepts, and understanding the basic physics influencing the built environment. It's about learning the initial language and tools of architecture. Successful completion is crucial as it provides the basic toolkit required for all subsequent design and technical studies.
        </p>
        <div class="table-responsive">
        <table id="sem1-table">
            <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR11</td>
                    <td contenteditable="true">Foundation Studio</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">Intro Digital Fabrication (3D Print, Laser Cut workshop). Digital Models.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td> <!-- Delete Button -->
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR12</td>
                    <td contenteditable="true">Culturescapes</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR13</td>
                    <td contenteditable="true">Environment and Building Physics</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td contenteditable="true">Basic Climate Analysis Tools (Climate Consultant or similar). Climate Data Viz.</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR14</td>
                    <td contenteditable="true">Architectural and Visual Representation</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Architectural Expression">Architectural Expression</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Architectural Expression">Architectural Expression</option></select></td>
                    <td contenteditable="true">Intro 2D CAD (AutoCAD). Digital Graphics & Presentation (Adobe PS, AI, ID).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <!-- Total Credits Row -->
                <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 1 Total</strong></td>
                    <td><strong>0</strong></td> <!-- Credits Total -->
                    <td colspan="9"></td> <!-- Spans remaining columns -->
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem1-table')">Add Course to Semester 1</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem1-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 2 -->
     <div class="semester-section">
        <h3>Semester 2 (Level 1: Foundation)</h3>
        <p class="semester-summary" id="sem2-summary" contenteditable="true">
            **Overall Theme:** Introduction to Architectural Design and Spatial Thinking<br>
            **Focus:** Building on the foundations of Sem 1, this semester introduces students to the core activity of architectural design within a simplified context. Emphasis is placed on developing spatial awareness, applying basic structural/environmental principles, and using both physical models and introductory 3D digital tools (like SketchUp) to explore form and space. The Communication course refines the representation skills acquired in Sem 1. This semester solidifies the transition from abstract principles to concrete design exploration and sets the stage for tackling more complex design problems in Level 2.
        </p>
        <div class="table-responsive">
        <table id="sem2-table">
            <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR21</td>
                    <td contenteditable="true">Introduction to Architectural Design</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">Intro 3D Modeling (SketchUp). Digital Models + Physical Prototypes.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR22</td>
                    <td contenteditable="true">Architecture and Change</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR23</td>
                    <td contenteditable="true">Climate, Site and Superstructure</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Structures">Structures</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td contenteditable="true">Climate Data Viz.</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR24</td>
                    <td contenteditable="true">Graphics and Communication</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Architectural Expression">Architectural Expression</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Architectural Expression">Architectural Expression</option></select></td>
                    <td contenteditable="true">Digital Drawing & Graphics (CAD, Adobe Suite).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 2 Total</strong></td>
                    <td><strong>0</strong></td>
                     <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem2-table')">Add Course to Semester 2</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem2-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 3 -->
    <div class="semester-section">
        <h3>Semester 3 (Level 2: Development)</h3>
        <p class="semester-summary" id="sem3-summary" contenteditable="true">
            **Overall Theme:** Integrated Design and Workflow Development<br>
            **Focus:** This semester marks the beginning of Level 2, focusing on developing more integrated design approaches. A key milestone is the mandatory introduction of BIM (Revit) within the studio, shifting from basic representation to integrated building information modeling. Technical courses delve deeper into environmental and structural principles with introductory simulation concepts. Electives offer initial exposure to computational design and coding, expanding the digital toolkit. This semester emphasizes connecting different aspects of architectural knowledge and introducing essential digital workflows for the rest of the program.
        </p>
        <div class="table-responsive">
        <table id="sem3-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR31</td>
                    <td contenteditable="true">S3 Vertical Studio</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">Mandatory BIM Introduction (Revit). Intermediate Rendering & Collaboration (Enscape/V-Ray, Miro). Milestone.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR32</td>
                    <td contenteditable="true">History and Construction</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Construction">Construction</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR33</td>
                    <td contenteditable="true">Environment and Building Structures</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Structures">Structures</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td contenteditable="true">Basic Env. Simulation (Ladybug Tools). Intro Structural Analysis concepts/SW (e.g., STAAD Pro, ETABS).</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR YY EX*</td>
                    <td contenteditable="true">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Theory & Methodologies">Theory & Methodologies</option></select></td>
                    <td contenteditable="true">*(One L2 Elective Recommended). Options: Intro Computational Design (Rhino + GH - Milestone), Python Basics (VAC?).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 3 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem3-table')">Add Course to Semester 3</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem3-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 4 -->
    <div class="semester-section">
        <h3>Semester 4 (Level 2: Development)</h3>
         <p class="semester-summary" id="sem4-summary" contenteditable="true">
            **Overall Theme:** Design of Habitable Environments<br>
            **Focus:** Applying the integrated workflow introduced in Sem 3, this semester focuses on the complex programmatic and spatial requirements of housing design. Students consolidate their BIM proficiency by developing detailed housing projects. Technical studies continue to build knowledge of building systems, incorporating basic simulation for specific aspects like lighting. This semester deepens the understanding of designing for human needs and provides a solid foundation for more specialized building types in later studios.
        </p>
        <div class="table-responsive">
        <table id="sem4-table">
             <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR41</td>
                    <td contenteditable="true">Housing Studio</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">BIM application (Revit - Milestone). Rendering & Collaboration (Enscape/V-Ray, Miro).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR42</td>
                    <td contenteditable="true">History and Urbanism 1</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                     <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR43</td>
                    <td contenteditable="true">Building Systems & Electrical Services</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Structures">Structures</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Structures">Structures</option></select></td>
                    <td contenteditable="true">Basic Lighting Simulation.</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR YY EX*</td>
                    <td contenteditable="true">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">*(One L2 Elective Recommended). Options: Continue Comp Design, Python, etc.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 4 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem4-table')">Add Course to Semester 4</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem4-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 5 -->
    <div class="semester-section">
        <h3>Semester 5 (Level 2: Development)</h3>
         <p class="semester-summary" id="sem5-summary" contenteditable="true">
            **Overall Theme:** Technical Resolution and Advanced Digital Exploration<br>
            **Focus:** This semester pushes students toward greater technical understanding and introduces more advanced digital methodologies. Detailing focuses on the practicalities of construction, while the studio and electives integrate sophisticated tools like computational design (Grasshopper) for complex forms/analysis, real-time rendering, and emerging technologies like AI and robotics. This semester deepens technical knowledge, broadens the digital skill set, and prepares students for the professional internship by exposing them to tools increasingly relevant in practice.
        </p>
        <div class="table-responsive">
        <table id="sem5-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                 <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR51</td>
                    <td contenteditable="true">S5 Vertical Studio</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                     <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">Advanced BIM Application (Revit). Computational Design Application (Grasshopper for Form-finding, Analysis). Real-time Rendering (Lumion, D5 Render).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR52</td>
                    <td contenteditable="true">History and Urbanism 2</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="History">History</option></select></td>
                    <td contenteditable="true"></td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR53</td>
                    <td contenteditable="true">Building Detailing & Valuation</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Construction">Construction</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Construction">Construction</option></select></td>
                    <td contenteditable="true">Advanced BIM Application (Revit Details).</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR YY EX*</td>
                    <td contenteditable="true">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">*(One L2 Elective Recommended). Options: Intro AI in Arch (Milestone, e.g., concepts, Rayan.design), Intro Digital Fab/Robotics (Workflows, CNC - Milestone).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 5 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                 </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem5-table')">Add Course to Semester 5</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem5-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 6 -->
    <div class="semester-section">
        <h3>Semester 6 (Level 3: Professional Practice)</h3>
         <p class="semester-summary" id="sem6-summary" contenteditable="true">
            **Overall Theme:** Applied Professional Practice<br>
            **Focus:** This semester is dedicated to gaining practical, real-world experience through a full-time professional internship. Students apply the knowledge, skills, and digital proficiency (BIM, CAD, etc.) learned in the first five semesters within an architectural office or related professional setting. This period is crucial for understanding industry workflows, project management, ethical considerations, and communication within a team, bridging the gap between academic study and professional reality. It prepares students for the final year of academic specialization and thesis development.
        </p>
        <div class="table-responsive">
        <table id="sem6-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR65</td>
                    <td contenteditable="true">Co-operative Learning (Internship)</td>
                    <td contenteditable="true" data-cell-type="credits">24</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Ethics">Ethics</option></select></td>
                    <td contenteditable="true">Real-world ethical scenarios, professional communication.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">Industry Software Exposure (Revit, CAD, Navisworks, Project Management SW, etc.). Full semester internship/practical training.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 6 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem6-table')">Add Course to Semester 6</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem6-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 7 -->
    <div class="semester-section">
        <h3>Semester 7 (Level 3: Specialization & Advanced Application)</h3>
        <p class="semester-summary" id="sem7-summary" contenteditable="true">
            **Overall Theme:** Urban Scale, Specialization & Research Foundations<br>
            **Focus:** This semester re-integrates students into academic study post-internship, expanding the focus to the urban scale and introducing advanced technical application and research. The Urban Studio requires tools like GIS and data analysis. Technical studies delve into complex simulations (CFD, ENVI-met) and management/interior systems. The Dissertation course begins here, focusing on research methodologies, while electives allow initial specialization in areas like advanced computation, AI, robotics, or visualization. This semester bridges practical experience with advanced academic inquiry, preparing students for the final thesis and professional practice courses.
        </p>
        <div class="table-responsive">
        <table id="sem7-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR71</td>
                    <td contenteditable="true">Urban Studio / Exchange Studio</td>
                    <td contenteditable="true" data-cell-type="credits">12</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Theory & Methodologies">Theory & Methodologies</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">Urban context analysis, site strategies.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Theory & Methodologies">Theory & Methodologies</option></select></td>
                    <td contenteditable="true">GIS (ArcGIS/QGIS). Data Viz. Photogrammetry SW. Urban-scale modeling.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR73</td>
                    <td contenteditable="true">Building Systems and Practices</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Structures">Structures</option></select></td>
                    <td contenteditable="true">MEP integration, sustainability systems, building code applications.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Climate Literacy">Climate Literacy</option></select></td>
                    <td contenteditable="true">Advanced Simulation (DesignBuilder, Autodesk CFD, ENVI-met). Energy modeling.</td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR85</td>
                    <td contenteditable="true">Dissertation</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Research Literacy">Research Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Research Literacy">Research Literacy</option></select></td>
                    <td contenteditable="true">Develop research question, methodology, literature review.</td>
                     <td class="riba-cell"><select class="riba-select"><option value="Ethics">Ethics</option></select></td>
                    <td contenteditable="true">Research ethics, citation standards.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">Research Tools, Data Analysis (Python/AI tools?).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR YY EX*</td>
                    <td contenteditable="true">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">*(One Elective Recommended for specialization track). Options: Adv. Comp Design, AI Apps (e.g., Rayan.design applications), Robotics in Fab, AR/VR, Adv. Viz.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 7 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem7-table')">Add Course to Semester 7</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem7-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 8 -->
    <div class="semester-section">
        <h3>Semester 8 (Level 4: Synthesis & Professional Readiness)</h3>
        <p class="semester-summary" id="sem8-summary" contenteditable="true">
            **Overall Theme:** Mastery, Synthesis & Professional Entry (Thesis/Capstone)<br>
            **Focus:** The final semester culminates in the Architectural Thesis or Capstone Project, a self-directed undertaking synthesizing all academic knowledge and practical internship experience. Students demonstrate mastery by applying advanced design methodologies, integrating complex technical systems (building on Sem 7), leveraging specialized digital tools based on project needs (computational design, simulation, fabrication, BIM coordination), and presenting their work professionally using advanced visualization techniques (VR/AR). The Professional Practice and Management courses directly address the business, legal, and ethical aspects of entering the profession and practice management, ensuring graduates are well-rounded and ready for initial practice and eventual licensure.
        </p>
        <div class="table-responsive">
        <table id="sem8-table">
            <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- New Column -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true">20BAR 101X*</td>
                    <td contenteditable="true">Architectural Thesis / Capstone Project</td>
                    <td contenteditable="true" data-cell-type="credits">15</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Research Literacy">Research Literacy</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Research Literacy">Research Literacy</option></select></td>
                    <td contenteditable="true">Independent research and design project integrating knowledge across disciplines.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Ethics">Ethics</option></select></td>
                    <td contenteditable="true">Ethical considerations in design outcomes, originality, intellectual property.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Design Pedagogies">Design Pedagogies</option></select></td>
                    <td contenteditable="true">Deep Tech Integration (Chosen tools: GH, AI (Rayan.design?), Fab, Simulation e.g., TRNSYS - Milestone). Advanced Visualization & VR/AR for presentation. BIM Coordination (Navisworks?).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR83</td>
                    <td contenteditable="true">Management and Interior Systems</td>
                    <td contenteditable="true" data-cell-type="credits">6</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Business Skills">Business Skills</option></select></td>
                    <td contenteditable="true">Project management principles, contracts, tenders. Interior systems detailing and integration.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true">20BAR 105</td>
                    <td contenteditable="true">Professional Practice</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="Business Skills">Business Skills</option></select></td>
                    <td contenteditable="true">Legal aspects, council regulations, ethics of practice, office organization.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="Professional Practice">Professional Practice</option></select></td>
                    <td contenteditable="true">Council ethics, professional responsibility, client communication.</td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">Digital Workflows, BIM Standards & Coordination (Navisworks), Collaboration tools (Miro, BIM360?).</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true">20BAR YY EX*</td>
                    <td contenteditable="true">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits">3</td>
                     <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true"></td>
                    <td class="riba-cell"><select class="riba-select"><option value="">Select</option></select></td>
                    <td contenteditable="true">*(One Elective Recommended). Final deep specialization related to thesis.</td>
                    <td contenteditable="true"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 8 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem8-table')">Add Course to Semester 8</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem8-unused-riba-list">Calculating...</span></p>
        </div>
    </div>


    <!-- General Notes Section -->
    <div id="general-notes-section">
        <h4>General Notes</h4>
        <textarea id="general-notes-area" placeholder="Enter any overall notes about the curriculum plan, technology choices, RIBA mapping, or implementation here..."></textarea>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button id="save-button" onclick="saveData()">Save Planner</button>
    </div>

    <!-- Save Notification -->
    <div id="save-notification" class="save-notification" role="alert">Planner saved successfully!</div>

</div><!-- /.curriculum-planner -->

<script>
    /* --- Start of Refined JavaScript v4 (Adapted for 4yr with Unused RIBA) --- */
    const ribaThemes = [
        "Health & Life Safety", "Ethics", "Professional Practice", "Structures",
        "Construction", "Resources", "History", "Theory & Methodologies",
        "Design Pedagogies", "Architectural Expression", "Business Skills",
        "Climate Literacy", "Research Literacy"
    ];
    // Updated Key for this 4-year version with Unused RIBA tracking
    const localStorageKey = 'bArchCurriculumData_Nitte_V4yr_UnusedRIBA';

    // --- Populate RIBA Dropdowns ---
    function populateRibaSelect(selectElement, selectedValue = "") {
        // Store current value if it exists
        const currentValue = selectedValue || selectElement.value;

        // Clear existing options
        selectElement.innerHTML = '';

        // Add a default "Select" option
        const defaultOption = document.createElement('option');
        defaultOption.value = "";
        defaultOption.textContent = "Select";
        selectElement.appendChild(defaultOption);

        // Add RIBA themes
        ribaThemes.forEach(theme => {
            const option = document.createElement('option');
            option.value = theme;
            option.textContent = theme;
            selectElement.appendChild(option);
        });

        // Set the selected value after populating
        selectElement.value = currentValue;
        // If the original value wasn't found, ensure 'Select' is shown
         if (selectElement.value !== currentValue && currentValue !== "") {
              selectElement.value = "";
         }
    }

    function initializeRibaDropdowns() {
        const allSelects = document.querySelectorAll('select.riba-select');
        allSelects.forEach(select => {
            populateRibaSelect(select, select.value); // Pass current value to retain it if present on load
        });
    }


    // --- Calculate Semester Credits ---
    function calculateSemesterCredits(tableId) {
        const table = document.getElementById(tableId);
        if (!table) return;
        // Select credit cells using the data attribute for robustness
        const creditCells = table.querySelectorAll('tbody tr:not(.total-credits-row) td[data-cell-type="credits"]');
        let totalCredits = 0;
        creditCells.forEach(cell => {
            // Use textContent for safety and trim whitespace
            const creditValue = parseInt(cell.textContent.trim()) || 0;
            totalCredits += creditValue;
        });
        const totalCell = table.querySelector('tbody tr.total-credits-row td:nth-child(2)'); // The cell displaying the total
        if (totalCell) {
            totalCell.textContent = totalCredits;
        } else {
             console.warn("Could not find total credits cell for table:", tableId);
        }
    }

     // --- Calculate All Semester Credits ---
     function calculateAllSemestersCredits() {
        // Loop for 8 semesters
        for (let i = 1; i <= 8; i++) {
            const tableId = `sem${i}-table`;
            // Check if table exists before calculating
            if(document.getElementById(tableId)){
                 calculateSemesterCredits(tableId);
            }
        }
     }

     // --- Calculate and Display Unused RIBA Themes for a Semester ---
     function calculateUnusedRiba(tableId) {
         const table = document.getElementById(tableId);
         if (!table) return;

         // Find the span element where the list should be displayed
         const unusedListId = tableId.replace('-table', '-unused-riba-list');
         const unusedListElement = document.getElementById(unusedListId);
         if (!unusedListElement) {
             console.warn(`Could not find unused RIBA list element with ID: ${unusedListId}`);
             return;
         }

         // Get all selected RIBA themes in this table
         const selectElements = table.querySelectorAll('tbody tr:not(.total-credits-row) select.riba-select');
         const usedThemes = new Set();

         selectElements.forEach(select => {
             const value = select.value.trim();
             if (value !== "" && ribaThemes.includes(value)) { // Only add if a valid RIBA theme and not "Select"
                 usedThemes.add(value);
             }
         });

         // Determine unused themes
         const unusedThemes = ribaThemes.filter(theme => !usedThemes.has(theme));

         // Update the display
         if (unusedThemes.length === 0) {
             unusedListElement.textContent = "All RIBA themes are used!";
         } else {
             unusedListElement.textContent = unusedThemes.join(', ');
         }
     }

    // --- Calculate All Semester Unused RIBA Themes ---
    function calculateAllSemestersUnusedRiba() {
         // Loop for 8 semesters
        for (let i = 1; i <= 8; i++) {
            const tableId = `sem${i}-table`;
             // Check if table exists before calculating
             if(document.getElementById(tableId)){
                 calculateUnusedRiba(tableId);
             }
         }
    }


    // --- Add Course Functionality ---
    function addCourseRevised(tableId, courseData = null) {
        const table = document.getElementById(tableId);
        if (!table) return;
        const tbody = table.getElementsByTagName('tbody')[0];
        const totalRow = tbody.querySelector('.total-credits-row');
        const newRow = document.createElement('tr');

        // Helper to create cells - handles 12 columns (11 data + 1 delete)
        const createCell = (content = "", isEditable = true, cellIndex, type = 'text') => {
            const cell = document.createElement('td');
             cell.setAttribute('spellcheck', 'false'); // Disable spellcheck for all editable cells

            if (type === 'select') {
                cell.classList.add('riba-cell');
                const select = document.createElement('select');
                select.classList.add('riba-select');
                // populateRibaSelect is called after cell is added to the DOM in addCourseRevised
                select.value = content; // Set initial value here, populate happens later
                cell.appendChild(select);
                cell.setAttribute('contenteditable', 'false');
            } else if (type === 'delete') {
                 cell.classList.add('delete-cell');
                 const deleteButton = document.createElement('button');
                 deleteButton.classList.add('delete-row-button');
                 deleteButton.innerHTML = '&times;';
                 deleteButton.title = 'Delete Row';
                 // Event listener added via delegation later
                 cell.appendChild(deleteButton);
                 cell.setAttribute('contenteditable', 'false');
            }
             else { // Text or rich content editable cells
                 cell.setAttribute('contenteditable', isEditable ? 'true' : 'false');

                 // Use innerHTML for notes/remarks/summaries to preserve formatting, textContent for others
                 if (isEditable && (cellIndex === 5 || cellIndex === 7 || cellIndex === 9 || cellIndex === 10)) {
                      cell.innerHTML = content; // Use innerHTML here for notes/remarks
                      cell.style.whiteSpace = 'pre-wrap'; /* Ensure line breaks are respected */
                 } else if (cellIndex === 2 && isEditable) {
                     cell.textContent = parseInt(content) || 0; // Ensure credits are numbers or 0
                     cell.setAttribute('data-cell-type', 'credits'); // Mark credits cell
                 }
                 else {
                     cell.textContent = content; // Use textContent for simple fields (Code, Title)
                 }
            }

            // Apply styles based on index (0-based)
             if (cellIndex === 2) { cell.style.textAlign = 'center'; } // Credits column

          return cell;
     }

        // Create 12 cells
        newRow.appendChild(createCell(courseData?.code, true, 0)); // Code
        newRow.appendChild(createCell(courseData?.title, true, 1)); // Title
        newRow.appendChild(createCell(courseData?.credits || "0", true, 2)); // Credits (uses data-cell-type)
        newRow.appendChild(createCell(courseData?.defaultRibaTheme, false, 3, 'select')); // Default RIBA Select
        newRow.appendChild(createCell(courseData?.acadRibaDirect, false, 4, 'select')); // Acad RIBA Select
        newRow.appendChild(createCell(courseData?.academicNotes, true, 5));          // Acad Notes (innerHTML)
        newRow.appendChild(createCell(courseData?.ethicsRibaDirect, false, 6, 'select')); // Ethics RIBA Select
        newRow.appendChild(createCell(courseData?.ethicsNotes, true, 7));             // Ethics Notes (innerHTML)
        newRow.appendChild(createCell(courseData?.techRibaDirect, false, 8, 'select'));   // Tech RIBA Select
        newRow.appendChild(createCell(courseData?.techNotes, true, 9));               // Tech Notes (innerHTML)
        newRow.appendChild(createCell(courseData?.remarks, true, 10));                // Remarks (innerHTML)
        newRow.appendChild(createCell(null, false, 11, 'delete'));                   // Actions (Delete Button)


        if (totalRow) {
            tbody.insertBefore(newRow, totalRow);
        } else {
            tbody.appendChild(newRow);
        }

         // Populate dropdowns *after* the row is added to the DOM
         newRow.querySelectorAll('select.riba-select').forEach(select => {
             populateRibaSelect(select, select.value); // Pass the value set earlier
         });

        calculateSemesterCredits(tableId);
        calculateUnusedRiba(tableId); // Calculate unused RIBA after adding course
    }


    // --- Event Handler for Credit Input ---
     function handleCreditInput(event) {
         const cell = event.target;
         // Use a regex that allows only digits
         let sanitizedValue = cell.textContent.replace(/[^0-9]/g, '');

         // Update cell content if needed and prevent cursor jump
         if (cell.textContent !== sanitizedValue) {
             // Save current cursor position
             const selection = window.getSelection();
             const range = document.createRange();
             let startOffset = selection.anchorOffset;
             let node = selection.anchorNode; // Node where the cursor is

             cell.textContent = sanitizedValue; // Update the content

             // Restore cursor position
             if (node && cell.contains(node)) {
                 // Find the new text node (should be the only child if only text)
                 const textNode = cell.firstChild;
                 if (textNode && textNode.nodeType === Node.TEXT_NODE) {
                     // Ensure startOffset doesn't exceed the new text length
                     startOffset = Math.min(startOffset, textNode.length);
                     try {
                         range.setStart(textNode, startOffset);
                         range.collapse(true);
                         selection.removeAllRanges();
                         selection.addRange(range);
                     } catch (e) {
                         console.error("Could not set selection:", e);
                         // Fallback: focus the cell without specific cursor position
                         cell.focus();
                     }
                 } else {
                      // If the cell is now empty or has non-text content after sanitization
                      cell.focus();
                 }
             } else {
                 // If the cursor was outside the cell or the node structure changed drastically
                 cell.focus();
             }
         }

         const table = cell.closest('table');
         if (table && table.id) {
             // Debounce the calculation slightly
             clearTimeout(cell._creditCalcTimer); // Clear any pending timer
             cell._creditCalcTimer = setTimeout(() => calculateSemesterCredits(table.id), 150); // Calculate after 150ms
         }
     }

     // --- Event Handler for Delete Row ---
     function handleDeleteRow(event) {
         // Check if the clicked element or its parent is the delete button
         const button = event.target.closest('.delete-row-button');
         if (!button) return; // Not a delete button click

         const row = button.closest('tr');
         if (!row) return; // Should not happen if button is found

         const table = row.closest('table');
         if (!table) return; // Should not happen if row is in a table

         // --- ADD CONFIRMATION DIALOG ---
         const cells = row.getElementsByTagName('td');
         let courseTitle = "this course";
         if (cells.length > 1 && cells[1].textContent.trim()) {
              courseTitle = `"${cells[1].textContent.trim()}"`;
         }

         if (!confirm(`Are you sure you want to delete ${courseTitle}? This action cannot be undone.`)) {
             return; // If user clicks Cancel, stop here
         }
         // --- END CONFIRMATION DIALOG ---

         const tableId = table.id; // Get tableId before removing the row
         row.remove(); // Remove the row from the DOM

         calculateSemesterCredits(tableId); // Recalculate credits for the semester table
         calculateUnusedRiba(tableId); // Recalculate unused RIBA for the semester table
         // Optional: show a notification for deletion? "Course deleted"?
     }

     // --- Event Handler for RIBA Select Change ---
     function handleRibaSelectChange(event) {
         if (event.target.tagName === 'SELECT' && event.target.classList.contains('riba-select')) {
             const table = event.target.closest('table');
             if (table && table.id) {
                 calculateUnusedRiba(table.id); // Recalculate unused RIBA for the affected semester
             }
         }
     }


    // --- Save Data Functionality ---
    function saveData() {
        const data = {
            semesters: {},
            summaries: {},
            generalNotes: document.getElementById('general-notes-area').value // Use .value for textarea
        };

        // Loop for 8 semesters
        for (let i = 1; i <= 8; i++) {
            const tableId = `sem${i}-table`;
            const table = document.getElementById(tableId);
            if (!table) continue;

            const tbody = table.getElementsByTagName('tbody')[0];
            // Select rows that are not the total row
            const rows = tbody.querySelectorAll('tr:not(.total-credits-row)');
            const semesterData = [];
            rows.forEach(row => {
                const cells = row.getElementsByTagName('td');
                // We expect 12 cells (11 data + 1 delete button)
                if (cells.length < 12) {
                     console.warn(`Skipping row in ${tableId} with unexpected number of cells (${cells.length}):`, row);
                     return;
                }

                // Capture data from the first 11 cells (indices 0-10)
                const course = {
                    code: cells[0].textContent.trim(), // Text field
                    title: cells[1].textContent.trim(), // Text field
                    credits: cells[2].textContent.trim(), // Text field (will be parsed to int on load)
                    defaultRibaTheme: cells[3].querySelector('select.riba-select')?.value || "", // Select value
                    acadRibaDirect: cells[4].querySelector('select.riba-select')?.value || "", // Select value
                    academicNotes: cells[5].innerHTML.trim(), // innerHTML for multi-line notes
                    ethicsRibaDirect: cells[6].querySelector('select.riba-select')?.value || "", // Select value
                    ethicsNotes: cells[7].innerHTML.trim(), // innerHTML for multi-line notes
                    techRibaDirect: cells[8].querySelector('select.riba-select')?.value || "",  // Select value
                    techNotes: cells[9].innerHTML.trim(), // innerHTML for multi-line notes
                    remarks: cells[10].innerHTML.trim() // innerHTML for multi-line remarks
                };
                semesterData.push(course);
            });
            data.semesters[`sem${i}`] = semesterData;

            // Save Summary Data
            const summaryElement = document.getElementById(`sem${i}-summary`);
            if (summaryElement) {
                data.summaries[`sem${i}`] = summaryElement.innerHTML.trim(); // Use innerHTML for summary
            }
        }

        try {
            localStorage.setItem(localStorageKey, JSON.stringify(data));
            showSaveNotification("Planner saved successfully!");
            console.log("Data saved:", data);
        } catch (error) {
            console.error("Error saving data to localStorage:", error);
            showSaveNotification("Error saving data. Storage might be full or disabled.", true);
        }
    }

     // --- Show Save Notification ---
     function showSaveNotification(message, isError = false) {
         const notification = document.getElementById('save-notification');
         if (!notification) return;

         notification.textContent = message;
         notification.classList.toggle('error', isError); // Add/remove error class

         // Force reflow to restart animation if already visible
         notification.classList.remove('show');
         void notification.offsetWidth; // Trigger reflow
         notification.classList.add('show');

         // Hide after 3 seconds
         if (notification._timer) clearTimeout(notification._timer);
         notification._timer = setTimeout(() => {
             notification.classList.remove('show');
         }, 3000);
     }


    // --- Load Data Functionality ---
    function loadData() {
        const savedDataString = localStorage.getItem(localStorageKey);
        let dataLoadedSuccessfully = false;
        if (savedDataString) {
             try {
                const savedData = JSON.parse(savedDataString);
                document.getElementById('general-notes-area').value = savedData.generalNotes || "";

                let semesterDataFound = false;
                 // Loop for 8 semesters
                for (let i = 1; i <= 8; i++) {
                    const semesterKey = `sem${i}`;
                    const tableId = `${semesterKey}-table`;
                    const table = document.getElementById(tableId);

                    if (table) {
                         const tbody = table.getElementsByTagName('tbody')[0];
                         // Remove all existing data rows (keep header and total row if they exist in HTML)
                         const existingRows = tbody.querySelectorAll('tr:not(.total-credits-row)');
                         existingRows.forEach(row => row.remove());

                         if (savedData.semesters && savedData.semesters[semesterKey] && savedData.semesters[semesterKey].length > 0) {
                             savedData.semesters[semesterKey].forEach(course => {
                                 addCourseRevised(tableId, course); // addCourseRevised calculates credits and unused RIBA
                             });
                             semesterDataFound = true;
                         } else {
                             // If no saved data for this table, initialize dropdowns on default rows
                             initializeRibaDropdowns();
                             // Also calculate unused RIBA for this potentially empty or default table
                             calculateUnusedRiba(tableId);
                         }

                         // Load Summary Data
                         const summaryElement = document.getElementById(`sem${i}-summary`);
                         if (summaryElement && savedData.summaries && savedData.summaries[semesterKey] !== undefined) {
                             summaryElement.innerHTML = savedData.summaries[semesterKey]; // Use innerHTML for summary
                         }
                    }
                }

                console.log("Data load attempt finished.");
                // Consider load successful if JSON parsed AND there was semester data
                if (semesterDataFound || (savedData.generalNotes !== undefined && savedData.generalNotes !== "") || (savedData.summaries && Object.keys(savedData.summaries).length > 0)) {
                    dataLoadedSuccessfully = true;
                } else {
                    console.log("No saved data found, using default HTML or empty tables.");
                }


            } catch (error) {
                console.error("Error parsing data from localStorage:", error);
                if (savedDataString) { // Only show error if there was saved data
                     showSaveNotification("Error loading saved data. It might be corrupted. Using default planner.", true);
                }
            }
        }

        if (!dataLoadedSuccessfully) {
             console.log("No valid saved data found. Ensuring default view is correctly initialized and calculating initial unused RIBA.");
             // Ensure all default dropdowns are populated if no data loaded successfully
             initializeRibaDropdowns();
             calculateAllSemestersUnusedRiba(); // Calculate for all semesters if no data loaded
        }

        // Always calculate credits after loading or initializing
        calculateAllSemestersCredits();
        // If data was loaded successfully, addCourseRevised already calculated unused RIBA per table.
        // If no data was loaded, we calculated them above.
        // So no need to call calculateAllSemestersUnusedRiba here *again* if loaded.
    }

    // --- Initial Setup & Event Delegation ---
    document.addEventListener('DOMContentLoaded', () => {
        loadData(); // Load data, which also initializes dropdowns and calculates initial values

        // Add event delegation for interactive elements within the planner
        const plannerDiv = document.querySelector('.curriculum-planner');
        if(plannerDiv) {
            plannerDiv.addEventListener('click', function(event) {
                // Delete button clicks
                if (event.target.classList.contains('delete-row-button')) {
                    handleDeleteRow(event); // This now also calls calculateUnusedRiba
                }
            });

            // Add event delegation for input changes (specifically credits)
             plannerDiv.addEventListener('input', function(event) {
                 // Check if the input is in a credit cell using the data attribute
                 if (event.target.tagName === 'TD' && event.target.isContentEditable && event.target.getAttribute('data-cell-type') === 'credits')
                 {
                      handleCreditInput(event); // This function handles calculation and sanitation
                 }
                  else if (event.target.isContentEditable || event.target.tagName === 'TEXTAREA') {
                     // Optional: Debounce auto-save for other editable areas
                     // Example (requires a debounce utility function):
                     // debounceSave();
                  }
             });

             // Add event delegation for select changes (RIBA dropdowns)
             plannerDiv.addEventListener('change', handleRibaSelectChange); // Call handler for RIBA select changes

              // Add input listener for summary paragraphs (delegated)
             plannerDiv.addEventListener('input', function(event) {
                 if (event.target.classList.contains('semester-summary')) {
                     // Optional: Debounce auto-save for summaries
                     // Example (requires a debounce utility function):
                     // debounceSave();
                 }
             });
        }
    });

    // Expose functions globally so HTML buttons work
    window.addCourse = addCourseRevised;
    window.saveData = saveData; // Ensure saveData is also global

    // Optional: Debounce utility function (can be used for auto-saving)
    /*
    function debounce(func, delay) {
        let timeout;
        return function(...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
        };
    }
    const debounceSave = debounce(saveData, 2000); // Auto-save after 2 seconds of inactivity
    */

    /* --- End of Refined JavaScript v4 (Adapted for 4yr with Unused RIBA) --- */
</script>

</body>
</html>